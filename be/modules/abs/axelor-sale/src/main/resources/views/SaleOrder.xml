<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

    <grid name="sale-order-quotation-grid" title="Sale quotations" model="com.axelor.apps.sale.db.SaleOrder" orderBy="-creationDate">
        <menubar>
            <menu title="Reports" icon="fa-files-o" showTitle="true">
                <item title="Print" action="action-sale-order-method-show-sale-order"/>
            </menu>
            <menu title="Tools" icon="fa-wrench" showTitle="true">
                <item title="Merge quotations" action="action-open-sale-quotation-merge-form"/>
                <item title="See quotation lines" action="action-view-open-quotation-lines"/>
            </menu>
        </menubar>
	    <hilite background="warning" if="(endOfValidityDate != null) &amp;&amp; ($moment(endOfValidityDate) &lt; $moment(todayDate)) &amp;&amp; (statusSelect == 3)"/>
	    <hilite background="danger" if="(endOfValidityDate != null) &amp;&amp; ($moment(endOfValidityDate) &lt; $moment(todayDate)) &amp;&amp; (statusSelect == 2)"/>
        <field name="endOfValidityDate" hidden="true"/>
        <field name="saleOrderSeq"/>
        <field name="company" form-view="company-form" grid-view="company-grid"/>
		<field name="tradingName" form-view="trading-name-form" grid-view="trading-name-grid" if="__config__.app.getApp('base').enableTradingNamesManagement"/>
        <field name="clientPartner" form-view="partner-form" grid-view="partner-grid"/>
        <field name="externalReference"/>
        <field name="creationDate"/>
        <field name="exTaxTotal" aggregate="sum"/>
        <field name="inTaxTotal" aggregate="sum"/>
        <field name="currency" form-view="currency-form" grid-view="currency-grid"/>
        <field name="statusSelect"/>
        <button name="print" title="Print" icon="fa-print" onClick="action-sale-order-method-show-sale-order"/>
        <button name="sendByEmail" title="Send email" icon="fa-envelope" onClick="action-send-by-email-with-template"/>
    </grid>

	<grid name="sale-order-grid" title="Sale orders"
		model="com.axelor.apps.sale.db.SaleOrder" orderBy="-creationDate">
        <menubar>
            <menu title="Reports" icon="fa-files-o" showTitle="true">
                <item title="Print" action="action-sale-order-method-show-sale-order"/>
            </menu>
            <menu title="Tools" icon="fa-wrench" showTitle="true">
                <item title="See sale orders lines" action="action-view-open-sale-order-lines"/>
            </menu>
        </menubar>
		<hilite background="warning"
			if="(endOfValidityDate != null) &amp;&amp; ($moment(endOfValidityDate) &lt; $moment(todayDate)) &amp;&amp; (statusSelect == 3)" />
		<hilite background="danger"
			if="(endOfValidityDate != null) &amp;&amp; ($moment(endOfValidityDate) &lt; $moment(todayDate)) &amp;&amp; (statusSelect == 2)" />
		<field name="endOfValidityDate" hidden="true" />
		<field name="saleOrderSeq" />
		<field name="company" form-view="company-form" grid-view="company-grid" />
        <field name="tradingName" form-view="trading-name-form" grid-view="trading-name-grid" if="__config__.app.getApp('base').enableTradingNamesManagement"/>
		<field name="clientPartner" form-view="partner-form" grid-view="partner-grid" />
		<field name="externalReference" />
		<field name="creationDate" />
		<field name="exTaxTotal" aggregate="sum" />
		<field name="inTaxTotal" aggregate="sum" />
		<field name="currency" form-view="currency-form" grid-view="currency-grid" />
		<field name="statusSelect" />
		<button name="print" title="Print" icon="fa-print"
			onClick="action-sale-order-method-show-sale-order" />
		<button name="sendByEmail" title="Send email" icon="fa-envelope"
			onClick="action-send-by-email-with-template" />
	</grid>

	<grid name="sale-order-partner-grid" title="Sale orders"
		model="com.axelor.apps.sale.db.SaleOrder" orderBy="-creationDate">
        <menubar>
            <menu title="Reports" icon="fa-files-o" showTitle="true">
                <item title="Print" action="action-sale-order-method-show-sale-order"/>
            </menu>
            <menu title="Tools" icon="fa-wrench" showTitle="true">
                <item title="See sale orders lines" action="action-view-open-sale-order-lines"/>
            </menu>
        </menubar>
		<field name="saleOrderSeq" />
		<field name="company" form-view="company-form" grid-view="company-grid" />
		<field name="tradingName" form-view="trading-name-form" grid-view="trading-name-grid" if="__config__.app.getApp('base').enableTradingNamesManagement"/>
        <field name="externalReference"/>
        <field name="creationDate"/>
        <field name="exTaxTotal" aggregate="sum"/>
        <field name="inTaxTotal" aggregate="sum"/>
		<field name="externalReference"/>
		<field name="statusSelect"/>
        <button name="print" title="Print" icon="fa-print" onClick="action-sale-order-method-show-sale-order"/>
        <button name="sendByEmail" title="Send email" icon="fa-envelope" onClick="action-send-by-email-with-template"/>
    </grid>

    <grid name="sale-order-opportunity-grid" title="Sale quotations" model="com.axelor.apps.sale.db.SaleOrder" orderBy="-creationDate">
        <hilite background="warning" if="(endOfValidityDate != null) &amp;&amp; ($moment(endOfValidityDate) &lt; $moment(todayDate)) &amp;&amp; (statusSelect == 3)"/>
        <hilite background="danger" if="(endOfValidityDate != null) &amp;&amp; ($moment(endOfValidityDate) &lt; $moment(todayDate)) &amp;&amp; (statusSelect == 2)"/>
        <field name="endOfValidityDate" hidden="true"/>
        <field name="saleOrderSeq"/>
        <field name="creationDate"/>
		<field name="exTaxTotal" aggregate="sum"/>
        <field name="inTaxTotal" aggregate="sum"/>
		<field name="currency" form-view="currency-form" grid-view="currency-grid"/>
		<field name="statusSelect" />
		<button name="print" title="Print" icon="fa-print"
			onClick="action-sale-order-method-show-sale-order" />
		<button name="sendByEmail" title="Send email" icon="fa-envelope"
			onClick="action-send-by-email-with-template" />
	</grid>

    <calendar name="sale-order-calendar" model="com.axelor.apps.sale.db.SaleOrder" eventStart="creationDate"
        eventLength="24" mode="month" title="Sale quotations/orders" colorBy="statusSelect" editable="false">
        <field name="fullName" />
    </calendar>

    <form name="sale-order-merge-form" model="com.axelor.apps.base.db.Wizard" title="Merge sale orders" width="large">
		<panel-related field="$saleOrderToMerge" form-view="sale-order-form" title="Sale orders to merge" colSpan="12" type="many-to-many" target="com.axelor.apps.sale.db.SaleOrder" domain="self.statusSelect = 1" canNew="false" canEdit="false" grid-view="sale-order-grid"/>
		<panel sidebar="true" title="Actions">
			<button name="generateMergedSaleOrder" title="Merge into single sale order" onClick="action-validate-sale-order-check-selection,action-group-sale-order-merge-action"/>
	  	</panel>
    </form>

    <form name="sale-quotation-merge-form" model="com.axelor.apps.base.db.Wizard" title="Merge quotations" width="large">
		<panel-related field="$saleQuotationToMerge" form-view="sale-order-form" title="Quotations to merge" colSpan="12" type="many-to-many" target="com.axelor.apps.sale.db.SaleOrder" domain="self.statusSelect = 1" canNew="false" canEdit="false" grid-view="sale-order-quotation-grid"/>
		<panel sidebar="true" title="Actions">
			<button name="generateMergedSaleOrder" title="Merge into single quotation" onClick="action-validate-sale-quotation-check-selection,action-group-sale-order-merge-action"/>
	  	</panel>
    </form>

    <form name="sale-order-merge-confirm-form" model="com.axelor.apps.base.db.Wizard" title="Confirmation" onNew="action-record-load-dummy-field-confirm-merge-saleorder">
		<panel colSpan="6" colOffset="3">
            <field name="priceListToCheck" hidden="true" colSpan="12" />
            <field name="locationToCheck" hidden="true" colSpan="12" />
            <field name="contactPartnerToCheck" hidden="true" colSpan="12" />
			<field name="$priceList" title="Price List" type="many-to-one" target="com.axelor.apps.base.db.PriceList" domain="self.typeSelect = 2 and self.isActive = true" colSpan="6" colOffset="3" width="200px" showIf="priceListToCheck" canSelect="true" form-view="price-list-form" grid-view="price-list-grid"/>
			<field name="$stockLocation" title="Stock location" showIf="locationToCheck" if-module="axelor-supplychain" colSpan="6" colOffset="3" width="200px" type="many-to-one" canSelect="true" target="com.axelor.apps.stock.db.StockLocation" domain="self.company = company and self.typeSelect = 1" form-view="stock-location-form" grid-view="stock-location-grid" if="__config__.app.isApp('supplychain')" />
			<field name="$contactPartner" title="Contact partner" type="many-to-one" target="com.axelor.apps.base.db.Partner" domain="self.isContact IS TRUE AND EXISTS (SELECT 1 FROM Partner part WHERE part.id = :partnerId AND self.id IN (SELECT id FROM part.contactPartnerSet))" colSpan="6" colOffset="3" width="200px" widget="SuggestBox" showIf="contactPartnerToCheck" form-view="partner-contact-form" grid-view="partner-contact-grid"/>
			<button name="confirm" title="Confirmer" onClick="action-group-sale-order-merge-action" colSpan="12" width="200px"/>
		</panel>
    </form>

    <form name="sale-order-cancel-wizard-form" model="com.axelor.apps.sale.db.SaleOrder" title="Cancellation confirmation" >
		<panel name="main">
			<field name="cancelReason" domain="self.applicationType = :_xApplicationType" colOffset="4" colSpan="4" widget="SuggestBox" canNew="false" canEdit="false" onChange="action-attrs-sale-other-reason"/>
			<field name="cancelReasonStr" colOffset="4" colSpan="4" hidden="true"/>
			<button name="cancelConfirm" title="Confirm cancellation" onClick="action-sale-order-cancel-reason-check,action-sale-order-method-confirm-cancel" colOffset="4" colSpan="4"/>
		</panel>
    </form>

    <form name="sale-order-form-wizard" title="Sale order" model="com.axelor.apps.sale.db.SaleOrder"
		onNew="action-group-sale-saleorder-onnew,action-sale-order-method-create-order"
		onLoad="action-group-sale-saleorder-onload">

		<panel-include view="sale-order-form"/>
	</form>

	<form name="sale-order-form-partner" title="Sale order" model="com.axelor.apps.sale.db.SaleOrder"
	onNew="action-group-sale-saleorder-onnew,action-group-partner-saleorder-onnew"
	onLoad="action-group-sale-saleorder-onload">

		<panel-include view="sale-order-form"/>
	</form>

	<form name="sale-order-form" title="Sale order"
		model="com.axelor.apps.sale.db.SaleOrder" id="sale-order-form"
		onNew="action-group-sale-saleorder-onnew" onLoad="action-group-sale-saleorder-onload">
	  <menubar>
	  	<menu title="Reports">
	  		<item action="save,action-sale-order-method-show-sale-order"
	  		 	title="Print" hideIf="clientPartner == null"/>
	  		<item action="save,action-sale-order-method-print-proforma-invoice"
	  			title="Print proforma invoice" hideIf="clientPartner == null"/>
	  		<item action="save,action-sale-order-method-export-sale-order-excel"
	  			title="Excel Export" hideIf="clientPartner == null"/>
	  		<item action="save,action-sale-order-method-export-sale-order-word"
	  			title="Word Export" hideIf="clientPartner == null"/>
	  	</menu>
	    <menu title="Tools">
		    <item title="Schedule Event" action="action-sale-order-view-schedule-event"
		    	hideIf="clientPartner == null"/>
            <item action="save,action-send-by-email-with-template" title="Send email"
            	hideIf="clientPartner == null"/>
		    <item action="save,action-sale-order-method-generate-template"
		    	title="Define as template" hideIf="clientPartner == null"/>
		</menu>
	  </menubar>
	  <panel title="Status">
      	<field name="statusSelect" showTitle="false" widget="NavSelect" colSpan="12"/>
      </panel>
	  <panel>
	  	<field name="clientPartner.saleOrderInformation" css="bold red" colSpan="12" showTitle="false" hideIf="clientPartner == null || clientPartner.saleOrderInformation == null"/>
		<field name="blockedOnCustCreditExceed" colSpan="4" readonly="true" showIf="blockedOnCustCreditExceed &amp;&amp; !manualUnblock" showTitle="false">
			<viewer depends="blockedOnCustCreditExceed">
			<![CDATA[
			<h5>
				<span class="label label-default" style="background-color: #B6473F; margin: 0px 0 !important; display: inline-table; line-height: initial;" ng-show="record.blockedOnCustCreditExceed" x-translate>Blocked</span>
			</h5>
			]]>
			</viewer>
		</field>
		<button name="manualUnblockButton" colSpan="4" showIf="blockedOnCustCreditExceed == true &amp;&amp; manualUnblock == false" css="btn-custom" onClick="action-sale-order-manual-unblock" title="Manual Unblock"/>
		<field name="manualUnblock" hidden="true"/>
        <field name="orderBeingEdited" hidden="true"/>
		<field name="$viewerOrderBeingEdited" showTitle="false" readonly="true" colSpan="9" showIf="orderBeingEdited">
		  <viewer depends="orderBeingEdited"><![CDATA[
	 		<h4>
	        	<span class="label label-important" ng-show="record.orderBeingEdited" x-translate>Order being edited</span>
	        </h4>
		  ]]></viewer>
		</field>
	    <field name="saleOrderSeq" css="label-bold bold"/>
	    <field name="$invoicingState" title="Invoicing State" readonly="true" css="label-bold bold" showIf="statusSelect >= 3">
	    	<viewer depends="amountInvoiced,exTaxTotal"><![CDATA[
	    		<div>
				  <div class="span7">
				  	<h5>
						<span class="label label-important" ng-show="record.amountInvoiced == 0"  x-translate>Not invoiced</span>
						<span class="label label-warning" ng-show="record.amountInvoiced > 0 && $number(record.amountInvoiced) < $number(record.exTaxTotal)" x-translate>Partially invoiced</span>
						<span class="label label-success" ng-show="record.amountInvoiced > 0 && record.amountInvoiced == record.exTaxTotal" x-translate>Invoiced</span>
					</h5>
				  </div>
				</div>
	    	]]></viewer>
	    </field>
	    <field name="company" canEdit="false" widget="SuggestBox" onChange="action-sale-group-onchange-company" form-view="company-form" grid-view="company-grid" readonlyIf="statusSelect == 3 || clientPartner != null" />
	    <field name="deliveryState" css="label-bold bold" showIf="statusSelect >= 3" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')">
	    	<viewer><![CDATA[
		  		<div>
				  <div class="span7">
					<h5>
						<span class="label label-important" ng-show="record.deliveryState == 1" x-translate>Not delivered</span>
						<span class="label label-warning" ng-show="record.deliveryState == 2" x-translate>Partially delivered</span>
						<span class="label label-success" ng-show="record.deliveryState == 3" x-translate>Delivered</span>
					</h5>
				  </div>
				</div>
	  		]]></viewer>
	    </field>
		<field name="tradingName" canEdit="false" grid-view="trading-name-grid" form-view="trading-name-form" if="__config__.app.getApp('base').enableTradingNamesManagement"
			readonlyIf="statusSelect >= 2" domain=":company MEMBER OF self.companySet" onChange="action-sale-method-printing-settings-default-values"/>
	    <field name="currency" canEdit="false"  form-view="currency-form" grid-view="currency-grid" readonlyIf="statusSelect &gt;= 2"/>
          <field name="saleOrderTypeSelect" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain').getAllowSusbcriptionSaleOrder()" readonlyIf="statusSelect &gt;= 2"/>
	    <field name="versionNumber" if="__config__.app.getApp('sale').getManageSaleOrderVersion()"/>
	    <field name="companyBankDetails" hidden="true" widget="SuggestBox" onSelect="com.axelor.apps.base.web.CompanyBankDetailsController:fillCompanyBankDetailsDomain" form-view="bank-details-form" grid-view="bank-details-grid"/>
	    <field name="inAti" hidden="true" onChange="action-sale-order-attrs-in-ati" readonlyIf="saleOrderLineList.length > 0 || statusSelect &gt;= 2"/>
		<field name="interco" hidden="true" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')"/>
	  </panel>
	  <panel name="customerInformation" title="Customer information" hideIf="company == null">
	      <field name="clientPartner" onChange="action-sale-order-group-client-partner-change,action-sale-order-record-compute-end-of-validity-date"
					onSelect="action-set-client-partner-domain" form-view="partner-form" grid-view="partner-grid" readonlyIf="saleOrderLineList.length > 0 || statusSelect &gt;= 2"/>
   	      <field name="contactPartner" onChange="action-record-so-contact-partner-change" onSelect="action-sale-order-domain-on-contact-partner" domain="self.isContact = true" form-view="partner-contact-form" grid-view="partner-contact-grid"/>
		  <panel stacked="true">
			  <field name="mainInvoicingAddress" canNew="true"
					 hideIf="$readonly() || statusSelect &gt; 1"
					 onChange="action-sale-order-method-address-str"
					 onSelect="action-sale-order-attrs-domain-main-invoicing-address"
					 form-view="address-partner-address-form"
					 grid-view="address-grid"/>
			  <field name="mainInvoicingAddressStr" readonlyIf="statusSelect &gt; 1" height="5">
				  <viewer>{{record.mainInvoicingAddressStr}}</viewer>
			  </field>
		  </panel>
		  <panel stacked="true">
			  <field name="deliveryAddress" canNew="true"
					 hideIf="$readonly() || statusSelect &gt; 1"
					 onChange="action-sale-order-method-address-str"
					 onSelect="action-sale-order-attrs-domain-delivery-address"
					 form-view="address-partner-address-form"
					 grid-view="address-grid"/>
			  <field name="deliveryAddressStr" readonlyIf="statusSelect &gt; 1" height="5">
				  <viewer>{{record.deliveryAddressStr}}</viewer>
			  </field>
		  </panel>
	      <field name="priceList" onSelect="action-sale-order-method-price-list-domain" onChange="action-sale-order-record-hide-discount" form-view="price-list-form"  grid-view="price-list-grid" readonlyIf="statusSelect &gt;= 2"/>
      	  <field name="externalReference"/>
      </panel>
	  <panel-tabs hideIf="clientPartner == null">
	    <panel name="content" title="Content">
	    	<panel-related field="saleOrderLineList" title="Details Lines" form-view="sale-order-line-form" colSpan="12" onChange="action-sale-order-line-change-group" readonlyIf="clientPartner == null || statusSelect == 2 || (statusSelect == 3 &amp;&amp; !orderBeingEdited) || statusSelect == 4" grid-view="sale-order-line-grid" canMove="true" orderBy="sequence"/>
	    	<panel-related field="saleOrderLineTaxList" colSpan="12" form-view="sale-order-line-tax-form" grid-view="sale-order-line-tax-grid"/>
	    	<panel title="Description to display" colSpan="12">
	        	<field name="description" showTitle="false" widget="Html" x-lite="true" colSpan="12"/>
	      	</panel>
	      	<panel title="Internal Note" colSpan="12">
	      		<field name="internalNote" showTitle="false" widget="Html" x-lite="true" colSpan="12"/>
	      	</panel>
	    </panel>
      	<panel name="deliveryInformation" title="Delivery information" colSpan="12" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')">
      		<field name="specificPackage" colSpan="12"/>
  		    <field name="stockLocation" domain="self.company = :company and self.typeSelect = 1" form-view="stock-location-form" grid-view="stock-location-grid"/>
  		    <field name="deliveryDate"/>
  		    <field name="deliveryCondition" colSpan="12"/>
  		    <field name="shipmentMode" form-view="shipment-mode-grid" grid-view="shipment-mode-grid" />
			<field name="freightCarrierMode" domain="self.shipmentMode = :shipmentMode" form-view="freight-carrier-mode-form" grid-view="freight-carrier-mode-grid" onChange="action-sale-order-record-freight-carrier"/>
  		    <field name="carrierPartner" domain="self.isCarrier = TRUE AND (self.companySet IS EMPTY OR :company MEMBER OF self.companySet)" form-view="partner-form" grid-view="partner-grid" canEdit="false"/>
            <field name="forwarderPartner" domain=":company MEMBER OF self.companySet" form-view="partner-form" grid-view="partner-grid" canEdit="false"/>
            <field name="incoterm" form-view="incoterm-form" grid-view="incoterm-grid" canEdit="false"/>
  		    <panel-dashlet action="action-view-show-stock-move-line" title="Customer deliveries" colSpan="12" showIf="statusSelect &gt;= 3" />
      	</panel>
	    <panel-dashlet action="action-view-show-invoices-from-sale-order" title="Invoicing" if-module="axelor-supplychain"  if="__config__.app.isApp('supplychain')" showIf="statusSelect &gt;= 3"/>
	    <panel name="projectPanel" if="__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getGenerateProjectOrder()" title="Business project" colSpan="12" if-module="axelor-business-project">
      		  <field name="project" domain="self.clientPartner = :clientPartner" form-view="project-form" grid-view="project-grid" colSpan="12"/>
			  <field name="$genProjTypePerOrderLine" title="Type of project's elements generated" x-enum-type="com.axelor.apps.project.db.GenProjTypePerOrderLine" showIf="project == null"/>
              <field name="project.genProjTypePerOrderLine" title="Type of project's elements generated" showIf="project != null"/>
	          <button name="generateProject" title="Generate Project/Business" if="!__config__.app.getApp('business-project').getAutomaticProject()" showIf="project == null" hidden="true" onClick="save,action-sale-order-method-generate-project"/>
	          <button name="generateTypePerOrderLine" title="Generate Elements" if="__config__.app.getApp('business-project').getProjectSaleOrderLines()" showIf="project != null" hidden="true" onClick="save,action-sale-order-method-generate-type-per-order-line,action-sale-order-attrs-hide-generate-type-per-order-line"/>
       	</panel>
		<panel name="timetable" title="Timetable" if-module="axelor-supplychain"  if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain').getAllowTimetableInvoicing()" >
			<field name="expectedRealisationDate" colSpan="12" width="50%"/>
 			<label title="OR"/>
			<field name="amountToBeSpreadOverTheTimetable" colSpan="12"/>
			<panel-related field="timetableList" colSpan="12" grid-view="timetable-grid" form-view="timetable-form" onChange="action-sale-order-method-update-amount-to-be-spread-over-the-timetable,action-supplychain-sale-order-validate-check-amount-timetable" if-module="axelor-supplychain"/>
		</panel>

		<panel-related field="advancePaymentList" colSpan="12" grid-view="advance-payment-grid" form-view="advance-payment-form" readonly="true" if-module="axelor-supplychain"  if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('account').getManageAdvancePaymentInvoice()" />
        <panel name="printing" title="Printing" if="__config__.app.getApp('sale').getPrintingConfigPerSaleOrder()">
			<field name="printingSettings" onSelect="action-sale-method-filter-printing-settings" canEdit="false"/>
            <field name="hideDiscount"/>
            <field name="specificNotes" colSpan="12" readonly="true" showIf="specificNotes"/>
        </panel>
        <panel-include view="incl-sale-order-subscrption-form" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain').getAllowSusbcriptionSaleOrder()" />
	  </panel-tabs>

	  <panel>
			<field name="attrs" colSpan="12" />
	  </panel>

	  <panel sidebar="true" name="actions" title="Actions" stacked="true" hideIf="clientPartner == null">
	    <button name="finalize" title="Finalize" showIf="statusSelect == 1" colSpan="12" onClick="save,action-sale-order-method-finalize-quotation"/>
        <button name="completeManuallySaleOrder" title="Complete manually sale order" if="(__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.allowCompleteManuallySaleOrder) || (!__config__.app.isApp('supplychain'))" showIf="statusSelect == 3" colSpan="12" onClick="save,action-sale-order-method-complete-sale-order"/>
	    <button name="newVersion" title="New version" if="__config__.app.getApp('sale').getManageSaleOrderVersion()" showIf="statusSelect == 2" colSpan="12" onClick="save,action-sale-record-newVersion,save"/>
        <button name="editOrder" title="Edit order" if="__config__.app.getApp('sale').allowPendingOrderModification" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" colSpan="12" onClick="action-sale-order-method-edit-order"/>
        <button name="validateChanges" title="Validate changes" showIf="statusSelect == 3 &amp;&amp; orderBeingEdited" colSpan="12" onClick="action-sale-order-validate-changes,save"/>
	    <button name="generateCustomerStockMove" title="Generate customer deliveries" colSpan="12" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited"
	    	if="__config__.app.getApp('supplychain')?.custStockMoveMgtOnSO &amp;&amp; !__config__.app.getApp('supplychain').customerStockMoveGenerationAuto"
	    	readonlyIf="!saleOrderLineList || !saleOrderLineList.length"
	    	onClick="save, action-supplychain-sale-order-create-stock-move"/>
	    <button name="confirmOrder" title="Confirm order" showIf="statusSelect == 2" colSpan="12" onClick="save,action-sale-group-confirmed"/>
	    <button name="generateInvoice" title="Generate invoice" if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain').getGenerateInvoiceFromSaleOrder()" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" colSpan="12" onClick="save,action-supplychain-sale-order-view-invoicing-wizard" if-module="axelor-supplychain"/>
	    <button name="generatePO" title="Generate purchase order"  colSpan="12" if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('supplychain').getPurchaseOrderGenerationAuto()" showIf="(statusSelect == 2 || statusSelect == 3) &amp;&amp; !orderBeingEdited" onClick="save,action-supplychain-sale-order-generate-purchase-orders-from-selected-SOLines"/>
	    <button name="generateProductionOrder" title="Generate production order"  colSpan="12" if="__config__.app.getApp('production')?.prodOrderMgtOnSO &amp;&amp; !__config__.app.getApp('production')?.productionOrderGenerationAuto" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" onClick="save,action-sale-order-method-create-production-order"/>
		<spacer/>
	    <button name="cancel" title="Cancel" showIf="id &amp;&amp; (statusSelect == 1 || statusSelect == 2)" colSpan="12" onClick="save,action-sale-order-view-cancel"/>
	  	<button name="addAdvancePayment" title="Register a deposit"
                showIf="statusSelect == 3 &amp;&amp; amountInvoiced == 0"
				colSpan="12" onClick="save,action-sale-order-view-register-advance-payment"
				if-module="axelor-supplychain"
				if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('account').getManageAdvancePaymentInvoice()" />
	  	<field name="message" hidden="true" type="string"/>
        <field name="amountInvoiced" hidden="true" />
		<button name="addLineFromConfigurator" title="Add Line from Configurator"
				onClick="save,action-sale-order-view-generate-line"
				showIf="statusSelect == 1"
				if="__config__.app.getApp('sale').getEnableConfigurator()"/>
	  </panel>

	  <panel sidebar="true" name="info" title="Info."  hideIf="clientPartner == null">
	    <field name="creationDate" readonlyIf="statusSelect != 1" colSpan="6" onChange="action-sale-order-record-compute-end-of-validity-date"/>
	    <field name="confirmedByUser" canNew="false" canEdit="false" canView="false" readonly="true" colSpan="6" showIf="statusSelect == 3" form-view="user-form" grid-view="user-grid"/>
	    <field name="confirmationDate" readonly="true" colSpan="6" showIf="statusSelect == 3"/>
	    <field name="orderDate" colSpan="6" showIf="statusSelect == 3"/>
	    <field name="orderNumber" colSpan="6" showIf="statusSelect == 3"/>
	    <field name="shipmentDate" colSpan="6" showIf="statusSelect == 3" if-module="axelor-supplychain"  if="__config__.app.isApp('supplychain')" />
	    <field name="duration" widget="SuggestBox" canNew="true" colSpan="6" onChange="action-sale-order-record-compute-end-of-validity-date" readonlyIf="statusSelect &gt;= 2"/>
	    <field name="endOfValidityDate" colSpan="6" readonly="true">
	    	<hilite if="$moment().diff(endOfValidityDate, 'days') &gt; 0 &amp;&amp; statusSelect != 3" color="danger"/>
	    </field>
	    <field name="expectedRealisationDate" colSpan="6" if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('supplychain').getAllowTimetableInvoicing()"/>
        <field name="cancelReason" hidden="true"/>
		<field name="cancelReasonStr" title="Cancel Reason" readonly="true" colSpan="12" css="red" hidden="true" showIf="cancelReason != null &amp;&amp; cancelReasonStr != null">
			<viewer><![CDATA[{{record.cancelReasonStr}}]]></viewer>
		</field>
		<field name="standardDelay" readonly="true" if-module="axelor-supplychain"   if="__config__.app.isApp('supplychain')" hidden="true" showIf="standardDelay &gt; 0" />
	  </panel>

        <panel sidebar="true" readonly="true"  colSpan="4"  hideIf="clientPartner == null">
            <field name="inTaxTotal" css="order-subtotal" showTitle="false" colSpan="12">
                <viewer depends="exTaxTotal,currency.symbol,taxTotal,statusSelect,amountInvoiced,advanceTotal">
                    <![CDATA[
                    <dl class="dl-horizontal">
                        <dt x-translate>Total W.T.</dt>
                        <dd>{{record.exTaxTotal}}  {{record.currency.symbol}}</dd>
                        <dt x-translate>Total tax</dt>
                        <dd>{{record.taxTotal}}  {{record.currency.symbol}}</dd>
                        <dt class="order-subtotal-total" x-translate>Total A.T.I.</dt>
                        <dd class="order-subtotal-total">{{record.inTaxTotal}}  {{record.currency.symbol}}</dd>
                        <dt ng-show="record.statusSelect >= 3" x-translate>Amount invoiced W.T.</dt>
                        <dd ng-show="record.statusSelect >= 3">{{record.amountInvoiced}}  {{record.currency.symbol}}</dd>
                        <dt ng-show="record.statusSelect >= 2" x-translate>Advance payment total</dt>
                        <dd ng-show="record.statusSelect >= 2">{{record.advanceTotal}}  {{record.currency.symbol}}</dd>
                    </dl>
                    ]]>
                </viewer>
            </field>

        </panel>

      <panel sidebar="true" itemSpan="6" title="Margin"  hideIf="clientPartner == null" readonly="true">
      		<field name="totalCostPrice"/>
      		<field name="totalGrossMargin"/>
      		<field name="marginRate"/>
      		<field name="company.currency" readonly="true" title="Company Currency"/>
      </panel>

      <panel sidebar="true"  hideIf="clientPartner == null">
      	<panel name="salesFollowUp" title="Sales follow-up" colSpan="12">
	        <field name="salemanUser" canNew="false" canEdit="false" canView="false" grid-view="user-grid" form-view="user-form"/>
            <field name="team" canEdit="false" onSelect="action-sale-order-domain-on-team" form-view="team-form" grid-view="team-grid" if="__config__.app.getApp('base').getTeamManagement()"/>
	        <field name="opportunity" colSpan="12" readonlyIf="statusSelect &gt;= 2" form-view="opportunity-form" grid-view="opportunity-grid" />
	    </panel>
	    <panel name="financialTerms" title="Financial terms" colSpan="12" if-module="axelor-supplychain"  if="__config__.app.isApp('supplychain')">
	        <field name="paymentMode" readonlyIf="statusSelect &gt;= 2" canEdit="false" onChange="action-sale-order-method-fill-company-bank-details" domain="self.inOutSelect = 1"  form-view="payment-mode-form" grid-view="payment-mode-grid"/>
	        <field name="paymentCondition" readonlyIf="statusSelect &gt;= 2" canEdit="false" form-view="payment-condition-form" grid-view="payment-condition-grid"/>
	    </panel>
      </panel>

      <panel-mail>
		  <mail-messages limit="4" />
		  <mail-followers />
	  </panel-mail>

	</form>

	<grid name="sale-order-template-grid" title="Templates"
		model="com.axelor.apps.sale.db.SaleOrder" orderBy="-creationDate">
		<field name="saleOrderSeq" />
		<field name="company" form-view="company-form" grid-view="company-grid" />
		<field  name="clientPartner" form-view="partner-form" grid-view="partner-grid" />
		<field name="externalReference" />
		<field name="creationDate" /><field name="exTaxTotal" aggregate="sum"/>
		<field name="exTaxTotal" aggregate="sum"/>
		<field name="inTaxTotal" aggregate="sum"/>
		<field name="currency" form-view="currency-form" grid-view="currency-grid"/>
	</grid>

    <form name="sale-order-template-form-wizard" title="Template" model="com.axelor.apps.sale.db.SaleOrder"
		onNew="action-group-sale-saleorder-onnew,action-saleorder-record-template,action-sale-order-method-create-template"
		onLoad="action-group-sale-saleorder-onload">

		<panel-include view="sale-order-template-form"/>
	</form>

	<form name="sale-order-template-form" title="Template" model="com.axelor.apps.sale.db.SaleOrder"
		onNew="action-group-sale-saleorder-onnew"
		onLoad="action-group-sale-saleorder-onload">
	  <panel>
	  	<field name="clientPartner.saleOrderInformation" css="bold red" colSpan="12" showTitle="false" hideIf="clientPartner == null || clientPartner.saleOrderInformation == null"/>
	    <field name="deliveryState" css="label-bold bold" showIf="statusSelect >= 3" />
	    <field name="company" canEdit="false" widget="SuggestBox" onChange="action-sale-group-onchange-company" form-view="company-form" grid-view="company-grid" readonlyIf="statusSelect == 3"/>
	    <field name="currency" canEdit="false" form-view="currency-form" grid-view="currency-grid" readonlyIf="statusSelect == 3"/>
	    <field name="templateUser" canNew="false" canEdit="false" canView="false" form-view="user-form" grid-view="user-grid"/>
	  </panel>

	  <panel name="customerInformation" title="Customer information">
	      <field name="clientPartner" onChange="action-sale-order-group-partner-change" onSelect="action-set-client-partner-domain" form-view="partner-form" grid-view="partner-grid" readonlyIf="statusSelect == 3"/>
   	      <field name="contactPartner" onChange="action-record-so-contact-partner-change" onSelect="action-sale-order-domain-on-contact-partner" domain="self.isContact = true" form-view="partner-contact-form" grid-view="partner-contact-grid"/>
          <panel stacked="true">
              <field name="mainInvoicingAddress" canNew="true"
					 hideIf="$readonly() || statusSelect &gt; 1"
					 onChange="action-sale-order-method-address-str"
                     onSelect="action-sale-order-attrs-domain-main-invoicing-address"
                     form-view="address-partner-address-form"
                     grid-view="address-grid"/>
			  <field name="mainInvoicingAddressStr" readonlyIf="statusSelect &gt; 1" height="5">
				  <viewer>{{record.mainInvoicingAddressStr}}</viewer>
			  </field>
          </panel>
          <panel stacked="true">
              <field name="deliveryAddress" canNew="true"
					 hideIf="$readonly() || statusSelect &gt; 1"
					 onChange="action-sale-order-method-address-str"
                     onSelect="action-sale-order-attrs-domain-delivery-address"
                     form-view="address-partner-address-form"
                     grid-view="address-grid"/>
			  <field name="deliveryAddressStr" readonlyIf="statusSelect &gt; 1" height="5">
				  <viewer>{{record.deliveryAddressStr}}</viewer>
			  </field>
          </panel>
	      <field name="priceList" onSelect="action-sale-order-method-price-list-domain" onChange="action-sale-order-record-hide-discount" form-view="price-list-form" grid-view="price-list-grid" readonlyIf="statusSelect == 3"/>
	      <field name="hideDiscount"/>
      	  <field name="externalReference"/>
      </panel>
	  <panel-tabs>
	    <panel name="content" title="Content">
	    	<panel-related field="saleOrderLineList" colSpan="12" onChange="action-sale-order-method-compute" form-view="sale-order-line-template-form" grid-view="sale-order-line-grid" canMove="true" orderBy="sequence"/>
	    	<panel-related field="saleOrderLineTaxList" colSpan="12" form-view="sale-order-line-tax-form" grid-view="sale-order-line-tax-grid"/>
	    </panel>
	    <panel name="otherInformations" title="Other informations" showTitle="false">
	      <panel name="salesFollowUp" title="Sales follow-up" colSpan="12">
	        <field name="salemanUser" canNew="false" canEdit="false" canView="false" form-view="user-form" grid-view="user-grid"/>
	        <field name="team" onSelect="action-sale-order-domain-on-team" form-view="team-form" grid-view="team-grid"/>
	      </panel>
	      <panel name="financialTerms" title="Financial terms" colSpan="12"  if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')">
	        <field name="paymentMode" domain="self.inOutSelect = 1" form-view="payment-mode-form" grid-view="payment-mode-grid"/>
	        <field name="paymentCondition" form-view="payment-condition-form" grid-view="payment-condition-grid"/>
	      </panel>
	      <panel name="stockLocation" title="Stock location" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')">
   		      <field name="stockLocation" domain="self.company = :company and self.typeSelect = 1" form-view="stock-location-form" grid-view="stock-location-grid"/>
	      </panel>
	      <panel name="description" title="Description" colSpan="12">
	        <field name="description" showTitle="false" widget="Html" x-lite="true" colSpan="12"/>
	      </panel>
	    </panel>

	    <panel name="projectPanel" if="__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getGenerateProjectOrder()" title="Business project" colSpan="12" if-module="axelor-business-project">
      		  <field name="project" domain="self.typeSelect = 'project'" form-view="project-form" grid-view="project-grid" colSpan="12"/>
       	</panel>
	  </panel-tabs>

	  <panel sidebar="true" name="actions" title="Actions">
	  	<button name="createOrder" title="Create Order from this Template" onClick="save,action-sale-order-method-generate-order"/>
	  </panel>

	  <panel sidebar="true" name="info" title="Info.">
	    <field name="creationDate"  readonlyIf="statusSelect != 1" colSpan="6" onChange="action-sale-order-record-compute-end-of-validity-date"/>
	    <field name="confirmedByUser" canNew="false" canEdit="false" canView="false" readonly="true" colSpan="6" showIf="statusSelect == 3" form-view="user-form" grid-view="user-grid"/>
	    <field name="confirmationDate" readonly="true" colSpan="6" showIf="statusSelect == 3"/>
	    <field name="orderDate" colSpan="6" showIf="statusSelect == 3"/>
	    <field name="orderNumber" colSpan="6" showIf="statusSelect == 3"/>
	    <field name="shipmentDate" colSpan="6" showIf="statusSelect == 3" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')" />
	    <field name="duration" widget="SuggestBox" canNew="true" colSpan="6" onChange="action-sale-order-record-compute-end-of-validity-date" readonlyIf="statusSelect == 3"/>
	  </panel>

        <panel sidebar="true" readonly="true"  colSpan="4">
            <field name="inTaxTotal" css="order-subtotal" showTitle="false" colSpan="12">
                <viewer depends="exTaxTotal,currency.symbol,taxTotal,statusSelect,amountInvoiced,advanceTotal">
                    <![CDATA[
                    <dl class="dl-horizontal">
                        <dt x-translate>Total W.T.</dt>
                        <dd>{{record.exTaxTotal}}</dd>
                        <dt x-translate>Total tax</dt>
                        <dd>{{record.taxTotal}}</dd>
                        <dt class="order-subtotal-total" x-translate>Total A.T.I.</dt>
                        <dd class="order-subtotal-total">{{record.inTaxTotal}}</dd>
                        <dt ng-show="record.statusSelect >= 3" x-translate>Amount invoiced W.T.</dt>
                        <dd ng-show="record.statusSelect >= 3">{{record.amountInvoiced}}  {{record.currency.symbol}}</dd>
                        <dt ng-show="record.statusSelect >= 2" x-translate>Advance payment total</dt>
                        <dd ng-show="record.statusSelect >= 2">{{record.advanceTotal}}  {{record.currency.symbol}}</dd>
                    </dl>
                    ]]>
                </viewer>
            </field>
        </panel>

	</form>

	<grid name="sale-order-grid-client" title="Sale orders"
		model="com.axelor.apps.sale.db.SaleOrder" orderBy="-creationDate">
		<field name="saleOrderSeq" />
		<field name="company" form-view="company-form" grid-view="company-grid" />
		<field name="clientPartner" form-view="partner-form" grid-view="partner-grid" />
		<field name="externalReference" />
		<field name="creationDate" />
		<field name="exTaxTotal" aggregate="sum"/>
        <field name="inTaxTotal" aggregate="sum" />
		<field name="currency" form-view="currency-form" grid-view="currency-grid"/>
        <field name="statusSelect" />
		<button name="print" title="Print" icon="fa-print"
			onClick="action-sale-order-method-show-sale-order" />
	</grid>


	<form name="sale-order-form-client" title="Sale order"
		model="com.axelor.apps.sale.db.SaleOrder" id="sale-order-form-client"
		onLoad="action-group-sale-saleorder-onload" onSave="save,action-sale-order-method-compute,save"
		onNew="action-group-sale-saleorder-onnew" width="large">
	  <toolbar>
	    <button name="print" title="Print" icon="fa-print" onClick="save,action-sale-order-method-show-sale-order"/>
	  </toolbar>
	  <panel name="main" readonly="true">
	    <field name="saleOrderSeq" css="highlight"/>
	    <field name="company" canEdit="false" widget="SuggestBox" form-view="company-form" grid-view="company-grid"/>
	    <field name="externalReference"/>
	    <field name="currency" canEdit="false" form-view="currency-form" grid-view="currency-grid"/>
	  </panel>
		<panel-tabs readonly="true">
			<panel name="customerInformation" title="Customer information" showTitle="false">
				<field name="clientPartner" form-view="partner-form" grid-view="partner-grid" canView="false"/>
				<panel stacked="true">
					<field name="mainInvoicingAddress" canNew="true"
						   hideIf="$readonly() || statusSelect &gt; 1"
						   onChange="action-sale-order-method-address-str"
						   onSelect="action-sale-order-attrs-domain-main-invoicing-address"
						   form-view="address-partner-address-form"
						   grid-view="address-grid"/>
					<field name="mainInvoicingAddressStr" readonlyIf="statusSelect &gt; 1" height="5">
						<viewer>{{record.mainInvoicingAddressStr}}</viewer>
					</field>
				</panel>

	      <field name="contactPartner" domain="self.isContact = true" form-view="partner-contact-form" grid-view="partner-contact-grid" canView="false"/>
				<panel stacked="true">
					<field name="deliveryAddress" canNew="true"
						   hideIf="$readonly() || statusSelect &gt; 1"
						   onChange="action-sale-order-method-address-str"
						   onSelect="action-sale-order-attrs-domain-delivery-address"
						   form-view="address-partner-address-form"
						   grid-view="address-grid"/>
					<field name="deliveryAddressStr" readonlyIf="statusSelect &gt; 1" height="5">
						<viewer>{{record.deliveryAddressStr}}</viewer>
					</field>
				</panel>
	      <panel colSpan="8">
	        <field name="confirmationDate"/>
	        <field name="creationDate"/>
	        <field name="orderDate"/>
	        <field name="shipmentDate" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')" />
	        <field name="duration"/>
	        <field name="endOfValidityDate">
	    		<hilite if="$moment().diff(endOfValidityDate, 'days') &gt; 0 &amp;&amp; statusSelect != 3" color="danger"/>
	    	</field>
	        <field name="salemanUser" canNew="false" canEdit="false" colSpan="10" form-view="user-form" grid-view="user-grid" canView="false"/>
	        <field name="statusSelect" widget="NavSelect" colSpan="12"/>
	      </panel>
            <panel readonly="true"  css="order-subtotal" colSpan="4">
                <field name="inTaxTotal" showTitle="false" colSpan="12">
                    <viewer depends="exTaxTotal,currency.symbol,taxTotal,statusSelect,amountInvoiced,advanceTotal">
                        <![CDATA[
                        <dl class="dl-horizontal">
                            <dt x-translate>Total W.T.</dt>
                            <dd>{{record.exTaxTotal}} {{record.currency.symbol}}</dd>
                            <dt x-translate>Total V.A.T.</dt>
                            <dd>{{record.taxTotal}} {{record.currency.symbol}}</dd>
                            <dt class="order-subtotal-total" x-translate>Total A.T.I.</dt>
                            <dd class="order-subtotal-total">{{record.inTaxTotal}} {{record.currency.symbol}}</dd>
                            <dt ng-show="record.statusSelect >= 3" x-translate>Amount invoiced W.T.</dt>
                            <dd ng-show="record.statusSelect >= 3">{{record.amountInvoiced}}  {{record.currency.symbol}}</dd>
                            <dt ng-show="record.statusSelect >= 2" x-translate>Advance payment total</dt>
                            <dd ng-show="record.statusSelect >= 2">{{record.advanceTotal}}  {{record.currency.symbol}}</dd>
                        </dl>
                        ]]>
                    </viewer>
                </field>
            </panel>
	    </panel>
	    <panel-related field="saleOrderLineList" showTitle="false" form-view="sale-order-line-form" grid-view="sale-order-line-grid" canMove="true" orderBy="sequence"/>
	    <panel-related field="saleOrderLineTaxList" showTitle="false" form-view="sale-order-line-tax-form" grid-view="sale-order-line-tax-grid"/>
	    <panel-dashlet action="action-view-show-invoices-from-sale-order" title="Invoicing"/>
	  </panel-tabs>
	</form>

	<cards name="sale-order-cards" title="Sale order" model="com.axelor.apps.sale.db.SaleOrder" width="300px"  css="rect-image" orderBy="-orderDate">
		<toolbar>
			<button name="mergeSaleOrders" title="Merge sale orders" onClick="action-open-sale-order-merge-form"/>
    		<button name="seeSaleOrderLines" title="See sale orders lines" onClick="action-view-open-sale-order-lines"/>
		</toolbar>
		<field name="saleOrderSeq"/>
		<field name="externalReference"/>
		<field name="clientPartner.fullName"/>
		<field name="orderDate"/>
		<field name="exTaxTotal"/>
		<field name="inTaxTotal"/>
		<field name="currency.symbol"/>
		<field name="statusSelect"/>
		<field name="deliveryState"/>
		<field name="amountInvoiced" />
        <field name="orderBeingEdited" />
		<template><![CDATA[
		    <div class="span12">
		    	<strong><span x-translate>Sale order</span> {{ saleOrderSeq }}</strong> <span ng-show="record.externalReference">( {{ externalReference }} )</span>
		    	<a class="pull-right muted">{{ $fmt('orderDate') }}</a>
	    	</div>
			<div>
			  <div>
				  <div class="span8">
				    <i class="fa fa-users" aria-hidden="true"></i>
				  	{{ clientPartner.fullName }}
				  </div>
					<div class="span4 pull-right">
						<i class="fa fa-long-arrow-right" aria-hidden="true"></i>
						<span ng-show="record.statusSelect == 1" x-translate>Draft quotation</span>
						<span ng-show="record.statusSelect == 2" x-translate>Finalized quotation</span>
						<span ng-show="record.statusSelect == 3" x-translate>Order confirmed</span>
						<span ng-show="record.statusSelect == 4" x-translate>Order completed</span>
						<span ng-show="record.statusSelect == 5" x-translate>Canceled</span>
					</div>
			  </div>
			  <div>
				  <div class="span6">
				  	<h5>
						<span class="label label-important"  ng-show="record.amountInvoiced == 0"  x-translate>Not invoiced</span>
						<span class="label label-warning" ng-show="record.amountInvoiced > 0 && $number(record.amountInvoiced) < $number(record.exTaxTotal)" x-translate>Partially invoiced</span>
						<span class="label label-success" ng-show="record.amountInvoiced > 0 && record.amountInvoiced == record.exTaxTotal" x-translate>Invoiced</span>
					</h5>
					<h5>
						<span class="label label-important" ng-show="record.deliveryState > 0 && record.deliveryState == 1" x-translate>Not delivered</span>
						<span class="label label-warning" ng-show="record.deliveryState > 0 && record.deliveryState == 2" x-translate>Partially delivered</span>
						<span class="label label-success" ng-show="record.deliveryState > 0 && record.deliveryState == 3" x-translate>Delivered</span>
					</h5>
                    <h5>
                        <span class="label label-important" ng-show="record.orderBeingEdited" x-translate>Order being edited</span>
                    </h5>
				  </div>
				  <div class="span6">
				    <span><strong><span x-translate>WT</span> : {{ $fmt('exTaxTotal') }} {{ currency.symbol }}</strong><br/>
				    <strong><span x-translate>ATI</span> : {{ $fmt('inTaxTotal') }} {{ currency.symbol }}</strong></span>
				  </div>
			  </div>
			</div>
		]]>
		</template>
	</cards>

	<cards name="sale-order-quotation-cards" title="Sale order quotation" model="com.axelor.apps.sale.db.SaleOrder" width="300px"  css="rect-image" orderBy="-orderDate">
		<field name="saleOrderSeq"/>
		<field name="externalReference"/>
		<field name="clientPartner.fullName"/>
		<field name="orderDate"/>
		<field name="exTaxTotal"/>
		<field name="inTaxTotal"/>
		<field name="currency.symbol"/>
		<field name="statusSelect"/>
		<field name="deliveryState"/>
		<field name="amountInvoiced" />
		<template><![CDATA[
		    <div class="span12">
		    	<strong><span x-translate>Sale quotation</span> {{ saleOrderSeq }}</strong> <span ng-show="record.externalReference">( {{ externalReference }} )</span>
		    	<a class="pull-right muted">{{ $fmt('orderDate') }}</a>
	    	</div>
			<div>
			  <div>
				  <div class="span8">
				    <i class="fa fa-users" aria-hidden="true"></i>
				  	{{ clientPartner.fullName }}
				  </div>
					<div class="span4 pull-right">
						<i class="fa fa-long-arrow-right" aria-hidden="true"></i>
						<span ng-show="record.statusSelect == 1" x-translate>Draft quotation</span>
						<span ng-show="record.statusSelect == 2" x-translate>Finalized quotation</span>
						<span ng-show="record.statusSelect == 3" x-translate>Order confirmed</span>
						<span ng-show="record.statusSelect == 4" x-translate>Order completed</span>
						<span ng-show="record.statusSelect == 5" x-translate>Canceled</span>
					</div>
			  </div>
			  <div>
				  <div class="span6">
				  	<h5>
						<span class="label label-important"  ng-show="record.amountInvoiced == 0"  x-translate>Not invoiced</span>
						<span class="label label-warning" ng-show="record.amountInvoiced > 0 && $number(record.amountInvoiced) < $number(record.exTaxTotal)" x-translate>Partially invoiced</span>
						<span class="label label-success" ng-show="record.amountInvoiced > 0 && record.amountInvoiced == record.exTaxTotal" x-translate>Invoiced</span>
					</h5>
					<h5>
						<span class="label label-important" ng-show="record.deliveryState > 0 && record.deliveryState == 1" x-translate>Not delivered</span>
						<span class="label label-warning" ng-show="record.deliveryState > 0 && record.deliveryState == 2" x-translate>Partially delivered</span>
						<span class="label label-success" ng-show="record.deliveryState > 0 && record.deliveryState == 3" x-translate>Delivered</span>
					</h5>
				  </div>
				  <div class="span6">
				    <span><strong><span x-translate>WT</span> : {{ $fmt('exTaxTotal') }} {{ currency.symbol }}</strong><br/>
				    <strong><span x-translate>ATI</span> : {{ $fmt('inTaxTotal') }} {{ currency.symbol }}</strong></span>
				  </div>
			  </div>
			</div>
		]]>
		</template>
	</cards>

	<action-method name="action-sale-order-method-generate-project">
		<call class="com.axelor.apps.businessproject.web.SaleOrderProjectController" method="generateProject"/>
	</action-method>

    <action-attrs name="action-sale-order-domain-on-team">
    	<attribute name="domain" for="team" expr="eval: salemanUser?.teamSet?.collect{it.id}?.size() > 0 ? &quot;self.id IN (${salemanUser?.teamSet?.collect{it.id}?.join(',')})&quot; : null"/>
    </action-attrs>

    <action-attrs name="action-sale-order-attrs-hide-generate-type-per-order-line">
    	<attribute name="hidden" for="generateTypePerOrderLine" expr="true"/>
    </action-attrs>

	<action-attrs name="action-attrs-sale-other-reason">
		<attribute for="cancelReasonStr" name="hidden" expr="cancelReason.freeText == false"/>
	</action-attrs>

	<action-group name="action-group-partner-saleorder-onnew">
		<action name="action-sale-order-record-from-partner"/>
		<action name="action-sale-order-record-partner"/>
        <action name="action-partner-attrs-hide-contact-partner"/>
		<action name="action-sale-order-validate-information"/>
        <action name="action-sale-order-method-address-str"/>
		<action name="action-sale-order-method-fill-price-list"/>
		<action name="action-sale-order-record-compute-end-of-validity-date"/>
        <action name="action-sale-order-method-fill-company-bank-details"/>
	</action-group>

	<action-group name="action-group-sale-order-merge-action">
	    <action name="action-sale-order-method-merge-sale" if="!__config__.app.isApp('supplychain')"/>
	    <action name="action-sale-order-method-merge-supplychain" if="__config__.app.isApp('supplychain')"/>
	</action-group>

    <action-group name="action-sale-group-onchange-company">
    	<action name="action-sale-order-record-company-configuration"/>
    	<action name="action-supplychain-sale-order-method-get-stock-location" />
        <action name="action-sale-order-method-fill-company-bank-details"/>
		<action name="action-sale-record-update-info-company"/>
    </action-group>

	<action-group name="action-sale-group-onchange-client-partner">
		<action name="action-sale-order-record-partner"/>
		<action name="action-partner-attrs-hide-contact-partner"/>
		<action name="action-sale-order-validate-information"/>
		<action name="action-sale-order-method-fill-company-bank-details"/>
		<action name="action-sale-method-printing-settings-default-values"/>
	</action-group>

    <action-group name="action-group-sale-saleorder-onnew">
    	<action name="action-sale-order-record-default"/>
    	<action name="action-sale-order-record-company-configuration"/>
    	<action name="action-sale-order-record-currency"/>
    	<action name="action-sale-order-attrs-collapse-specific-settings-group"/>
    	<action name="action-sale-order-record-in-ati"/>
    	<action name="action-sale-order-attrs-in-ati"/>
        <action name="action-sale-order-attrs-hidden-bank-details"/>
        <action name="action-sale-order-method-fill-company-bank-details"/>
    </action-group>

    <action-group name="action-group-sale-saleorder-onload">
    	<action name="action-sale-order-attrs-collapse-specific-settings-group"/>
    	<action name="action-partner-attrs-hide-contact-partner" />
    	<action name="action-sale-order-attrs-in-ati"/>
		<action name="action-sale-order-attrs-hidden-bank-details"/>
    </action-group>

	<action-group name="action-sale-group-confirmed">
    	<action name="action-sale-order-method-generate-project" if="__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getAutomaticProject()"/>
		<action name="action-sale-order-validate-check-on-confirm"/>
    	<action name="action-sale-order-method-confirm"/>
    </action-group>

    <action-group name="action-sale-order-line-change-group">
    	<action name="save" if="saleOrderLineList?.find{it->it.subLineList.find{t->t.saleOrder == null} != null} != null" />
    	<action name="action-sale-order-method-compute"/>
    	<action name="action-sale-order-method-compute-margin"/>
    	<action name="save" if="saleOrderLineList?.find{it->it.subLineList.find{t->t.saleOrder == null} != null} != null" />
    </action-group>

	<action-group name="action-sale-order-group-client-partner-change">
		<action name="action-sale-order-record-partner"/>
        <action name="action-partner-attrs-hide-contact-partner"/>
		<action name="action-sale-order-validate-information"/>
        <action name="action-sale-order-method-address-str"/>
		<action name="action-sale-order-method-fill-price-list"/>
		<action name="action-sale-order-attrs-interco"
				if="__config__.app.isApp('supplychain')"/>
		<action name="action-sale-order-record-interco"
				if="__config__.app.isApp('supplychain')"/>
		<action name="action-sale-order-record-set-contact-partner"/>
		<action name="action-sale-order-record-partner-supplychain" 
				if="__config__.app.isApp('supplychain')"/>
	</action-group>

    <action-attrs name="action-sale-order-attrs-in-ati">
    	<attribute name="hidden" for="saleOrderLineList.exTaxTotal" expr="inAti"/>
    	<attribute name="hidden" for="saleOrderLineList.price" expr="inAti"/>
    	<attribute name="hidden" for="saleOrderLineList.inTaxTotal" expr="!inAti"/>
    	<attribute name="hidden" for="saleOrderLineList.inTaxPrice" expr="!inAti"/>
    	<attribute name="hidden" for="inAti" expr=" eval: __repo__(SaleConfig).all().filter('self.company = ?',company).fetchOne()?.saleOrderInAtiSelect == 1
    									|| __repo__(SaleConfig).all().filter('self.company = ?',company).fetchOne()?.saleOrderInAtiSelect == 2"/>
    </action-attrs>

    <action-record name="action-sale-order-record-set-contact-partner" model="com.axelor.apps.sale.db.SaleOrder">
    	<field name="contactPartner" expr="eval:null"/>
    </action-record>

    <action-record name="action-sale-order-record-from-partner" model="com.axelor.apps.sale.db.SaleOrder">
    	<field name="clientPartner" expr="eval: _partner" if="_partner.isContact == false"/>
    	<field name="clientPartner" expr="eval: __repo__(Partner).find(_partner.mainPartner.id)" if="_partner.isContact == true &amp; _partner.mainPartner != null"/>
    	<field name="contactPartner" expr="eval: _partner" if="_partner.isContact == true"/>
    </action-record>

    <action-record name="action-sale-order-record-in-ati" model="com.axelor.apps.sale.db.SaleOrder">
    	<field name="inAti" expr="eval: __repo__(SaleConfig).all().filter('self.company = ?',company).fetchOne()?.saleOrderInAtiSelect == 2
    									|| __repo__(SaleConfig).all().filter('self.company = ?',company).fetchOne()?.saleOrderInAtiSelect == 4"/>
    </action-record>

	<action-method name="action-sale-order-method-update-amount-to-be-spread-over-the-timetable" if-module="axelor-supplychain">
		<call class="com.axelor.apps.supplychain.web.SaleOrderController" method="updateAmountToBeSpreadOverTheTimetable"/>
	</action-method>

    <action-method name="action-sale-order-method-finalize-quotation">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="finalizeQuotation"/>
	</action-method>

    <action-method name="action-sale-order-method-complete-sale-order">
        <call class="com.axelor.apps.sale.web.SaleOrderController" method="completeSaleOrder"/>
    </action-method>

	<action-method name="action-sale-order-method-merge-sale">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="mergeSaleOrder"/>
	</action-method>

	<action-method name="action-sale-order-method-merge-supplychain" if-module="axelor-supplychain">
		<call class="com.axelor.apps.supplychain.web.SaleOrderController" method="mergeSaleOrder"/>
	</action-method>

    <action-method name="action-sale-order-method-confirm">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="confirmSaleOrder"/>
	</action-method>

    <action-method name="action-sale-order-method-show-sale-order">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="showSaleOrder"/>
	</action-method>

    <action-method name="action-sale-order-method-print-proforma-invoice">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="printProformaInvoice"/>
	</action-method>

	<action-method name="action-sale-order-method-export-sale-order-excel">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="exportSaleOrderExcel"/>
	</action-method>

	<action-method name="action-sale-order-method-export-sale-order-word">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="exportSaleOrderWord"/>
	</action-method>

	<action-method name="action-sale-order-method-fill-price-list">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="fillPriceList"/>
	</action-method>

	<action-method name="action-sale-order-method-price-list-domain">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="changePriceListDomain"/>
	</action-method>

	<action-method name="action-sale-order-method-generate-type-per-order-line">
		<call class="com.axelor.apps.businessproject.web.SaleOrderProjectController" method="generateTypePerOrderLineForProject"/>
	</action-method>
	
    <action-record name="action-sale-record-newVersion" model="com.axelor.apps.sale.db.SaleOrder">
    	<field name="statusSelect" expr="eval: 1"/>
    	<field name="deliveryState" expr="eval: 1"/>
    	<field name="versionNumber" expr="eval: versionNumber + 1"/>
    </action-record>

    <action-view name="action-open-sale-order-merge-form" title="Merge sale orders" model="com.axelor.apps.base.db.Wizard">
	    <view type="form" name="sale-order-merge-form"/>
	</action-view>

	<action-view name="action-open-sale-quotation-merge-form" title="Merge sale quotation" model="com.axelor.apps.base.db.Wizard">
	    <view type="form" name="sale-quotation-merge-form"/>
	</action-view>

    <action-view name="action-sale-order-view-cancel" title="Cancellation" model="com.axelor.apps.sale.db.SaleOrder">
	  	<view type="form" name="sale-order-cancel-wizard-form"/>
	  	<view-param name="popup" value="reload"/>
	  	<view-param name="show-toolbar" value="false"/>
	  	<view-param name="show-confirm" value="false" />
  	  	<view-param name="popup-save" value="false"/>
	  	<view-param name="forceEdit" value="true" />
	  	<context name="_showRecord" expr="eval: __this__.id" />
        <context name="_xApplicationType" expr="eval: _model"/>
	</action-view>

    <action-condition name="action-sale-order-cancel-reason-check">
		<check error="A cancel reason must be selected" field="cancelReason" if="cancelReason == null || cancelReason == 0"/>
	</action-condition>

	<action-method name="action-sale-order-method-confirm-cancel">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="cancelSaleOrder"/>
	</action-method>

	<action-record name="action-record-load-dummy-field-confirm-merge-saleorder" model="com.axelor.apps.base.db.Wizard">
		<field name="priceListToCheck" expr="eval: contextPriceListToCheck"/>
		<field name="contactPartnerToCheck" expr="eval: contextContactPartnerToCheck"/>
		<field name="locationToCheck" expr="eval: contextLocationToCheck"/>
		<field name="partnerId" expr="eval: contextPartnerId"/>
	</action-record>

    <action-record name="action-sale-order-record-currency" model="com.axelor.apps.sale.db.SaleOrder">
	    <field name="currency" expr="eval: company?.currency"/>
	</action-record>

    <action-record name="action-sale-order-record-default" model="com.axelor.apps.sale.db.SaleOrder">
    	<field name="exTaxTotal" expr="eval: 0"/>
    	<field name="taxTotal" expr="eval: 0"/>
    	<field name="inTaxTotal" expr="eval: 0"/>
    	<field name="amountInvoiced" expr="eval: 0"/>
        <field name="advanceTotal" expr="eval: 0"/>
    	<field name="creationDate" expr="eval: __date__"/>
    	<field name="statusSelect" expr="eval: 1"/>
    	<field name="company"  expr="eval:__user__.activeCompany" if="__user__.activeCompany != null"/>
    	<field name="company"  expr="eval:__repo__(Company).all().fetchOne()" if="__user__.activeCompany == null &amp;&amp; __repo__(Company).all().fetch().size == 1"/>
    	<field name="salemanUser" expr="eval:__user__"/>
    	<field name="team" expr="call:com.axelor.apps.base.service.user.UserService:getUserActiveTeam()"/>
    	<field name="template" expr="eval:_template" />
		<field name="printingSettings" expr="eval: __user__.activeCompany?.printingSettings" if="__user__.activeCompany != null"/>
    </action-record>

    <action-record name="action-sale-order-record-company-configuration" model="com.axelor.apps.sale.db.SaleOrder">
    	<field name="duration" expr="eval: company?.saleConfig?.defaultValidityDuration"/>
    </action-record>

    <action-record name="action-sale-order-record-partner" model="com.axelor.apps.sale.db.SaleOrder">
    	<field name="paymentCondition" expr="eval: clientPartner?.paymentCondition" if="__config__.app.isApp('account') &amp;&amp; clientPartner?.paymentCondition != null"/>
    	<field name="paymentCondition" expr="eval: company?.accountConfig?.defPaymentCondition" if="__config__.app.isApp('account') &amp;&amp; clientPartner?.paymentCondition == null"/>
 		<field name="currency" expr="eval: clientPartner?.currency"/>
		<field name="paymentMode" expr="eval: clientPartner?.inPaymentMode" if="__config__.app.isApp('supplychain') &amp;&amp; clientPartner?.inPaymentMode != null"/>
		<field name="paymentMode" expr="eval: company?.accountConfig?.inPaymentMode" if="__config__.app.isApp('supplychain') &amp;&amp; clientPartner?.inPaymentMode == null"/>
		<field name="mainInvoicingAddress" expr="call:com.axelor.apps.base.service.PartnerService:getInvoicingAddress(clientPartner)" if="clientPartner != null"/>
		<field name="deliveryAddress" expr="call:com.axelor.apps.base.service.PartnerService:getDeliveryAddress(clientPartner)" if="clientPartner != null"/>
		<field name="hideDiscount" expr="eval: priceList?.hideDiscount"/>
		<field name="companyBankDetails" expr="call: com.axelor.apps.account.service.AccountingSituationService:getCompanySalesBankDetails(company, clientPartner)"/>
    </action-record>

    <action-record name="action-sale-order-record-hide-discount" model="com.axelor.apps.sale.db.SaleOrder">
		<field name="hideDiscount" expr="eval: priceList?.hideDiscount"/>
	</action-record>

	<action-record name="action-record-so-contact-partner-change" model="com.axelor.apps.sale.db.SaleOrder">
    	<field name="clientPartner" expr="eval: contactPartner.mainPartner" if="contactPartner.mainPartner != null"/>
    </action-record>

    <action-method name="action-sale-order-record-compute-end-of-validity-date">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="computeEndOfValidityDate"/>
    </action-method>

    <action-method name="action-sale-order-method-compute">
        <call class="com.axelor.apps.sale.web.SaleOrderController" method="compute"/>
  	</action-method>

  	<action-method name="action-sale-order-method-compute-margin">
        <call class="com.axelor.apps.sale.web.SaleOrderController" method="computeMargin"/>
  	</action-method>

	<action-attrs name="action-sale-order-attrs-collapse-specific-settings-group">
		<attribute name="collapse" for="specificSettings" expr="eval: true"/>
	</action-attrs>

	<action-attrs name="action-sale-order-domain-on-contact-partner">
		<attribute for="contactPartner" if="clientPartner != null &amp;&amp; !clientPartner.contactPartnerSet.empty" name="domain" expr="eval: &quot;self.id IN (${clientPartner.contactPartnerSet?.collect{it.id}.join(',')})&quot;"/>
 		<attribute for="contactPartner" if="clientPartner != null &amp;&amp; clientPartner.contactPartnerSet.empty" name="domain" expr="eval: &quot;self.id IN (0)&quot;"/>
 		<attribute for="contactPartner" if="clientPartner == null" name="domain" expr="eval: &quot;self.isContact = true&quot;"/>
	</action-attrs>

    <action-attrs name="action-sale-order-attrs-domain-main-invoicing-address">
		<attribute name="domain" for="mainInvoicingAddress" expr="eval: &quot;self.id IN (${(clientPartner?.partnerAddressList?.findAll{it.isInvoicingAddr}.collect{it.address.id}+[null]).join(',')})&quot;"/>
    </action-attrs>

    <action-attrs name="action-sale-order-attrs-domain-delivery-address">
		<attribute name="domain" for="deliveryAddress" expr="eval: &quot;self.id IN (${(clientPartner?.partnerAddressList?.findAll{it.isDeliveryAddr}.collect{it.address.id}+[null]).join(',')})&quot;"/>
    </action-attrs>

	<action-attrs name="action-sale-order-attrs-hidden-bank-details">
		<attribute for="companyBankDetails" name="hidden" expr="eval: !__config__.app.getApp('base').getManageMultiBanks()"/>
	</action-attrs>

	<action-attrs name="action-set-client-partner-domain">
 		<attribute name="domain" for="clientPartner" expr="eval:&quot;self.id != ${company.partner?.id} AND self.isContact = false and (self.isCustomer = true or self.isProspect = true)&quot;"/>
 	</action-attrs>

	<search-filters name="sale-order-filters" model="com.axelor.apps.sale.db.SaleOrder" title="Sales Order filters">
		<field name="saleOrderLineList.product.name" title="Product Name"/>
		<filter title="My Proposals">
			<domain>(self.statusSelect = 1 or self.statusSelect = 2) and self.salemanUser.id = :_internalUser</domain>
		</filter>
		<filter title="My Sales">
			<domain>self.statusSelect = 3 and self.salemanUser.id = :_internalUser</domain>
		</filter>
		<filter title="My Team Proposals">
			<domain>(self.statusSelect = 1 or self.statusSelect = 2) and self.team = :_myActiveTeam</domain>
		</filter>
		<filter title="My Team Sales">
			<domain>self.statusSelect = 3 and self.team = :_myActiveTeam</domain>
		</filter>
	</search-filters>

	<action-view name="action-sale-order-view-schedule-event" title="Schedule Event" model="com.axelor.apps.crm.db.Event">
    	<view type="form" name="event-form"/>
    	<context name="_saleOrder" expr="eval:_ids != null ? __repo__(SaleOrder).find(_ids.get(0)) : __this__"/>
    	<context name="_clientPartner" expr="eval: _ids != null ? __repo__(SaleOrder).find(_ids.get(0)).clientPartner : __self__.clientPartner" />
  		<context name="_contactPartner" expr="eval: _ids != null ? __repo__(SaleOrder).find(_ids.get(0)).contactPartner : __self__.contactPartner" />
    </action-view>

    <action-view name="action-sale-order-view-register-advance-payment" title="Register a deposit" model="com.axelor.apps.sale.db.AdvancePayment">
    	<view type="form" name="advance-payment-form"/>
    	<view-param name="popup" value="reload"/>
	  	<view-param name="show-toolbar" value="false"/>
	  	<view-param name="forceEdit" value="true" />
	  	<view-param name="popup-save" value="true"/>
 	  	<view-param name="show-confirm" value="true"/>
	  	<context name="_saleOrder" expr="eval: __this__"/>
    </action-view>

	<action-view name="action-view-show-stock-move-line" title="Customer deliveries" model="com.axelor.apps.stock.db.StockMoveLine">
		<view type="grid" name="stock-move-line-sale-order-grid"/>
		<view type="form" name="stock-move-line-form"/>
		<domain>self.stockMove.saleOrder = :saleOrder</domain>
		<context name="saleOrder" expr="eval: __self__"/>
	</action-view>

	<action-view name="action-view-open-quotation-lines" title="Quotation lines" model="com.axelor.apps.sale.db.SaleOrderLine">
		<view type="grid" name="sale-order-line-menu-grid"/>
		<view type="form" name="sale-order-line-form"/>
		<domain>self.saleOrder.statusSelect in (1,2)</domain>
	</action-view>

	<action-view name="action-view-open-sale-order-lines" title="Sale order lines" model="com.axelor.apps.sale.db.SaleOrderLine">
		<view type="grid" name="sale-order-line-menu-grid"/>
		<view type="form" name="sale-order-line-form"/>
		<domain>self.saleOrder.statusSelect IN (:_status)</domain>
  		<context name="_status" expr="eval: status"/>
	</action-view>

	<action-view name="action-sale-order-view-generate-line" title="Generate configurator" model="com.axelor.apps.sale.db.Configurator">
        <view type="form" name="generate-configurator-form"/>
		<view-param name="popup" value="reload"/>
		<view-param name="popup-save" value="false"/>
		<view-param name="show-toolbar" value="false"/>
		<view-param name="show-confirm" value="false"/>
        <context name="_saleOrderId" expr="eval: id"/>
	</action-view>

	<action-validate name="action-sale-order-validate-information">
		<info message="${clientPartner?.saleOrderInformation}" if="clientPartner?.saleOrderInformation != null &amp;&amp; !clientPartner?.saleOrderInformation.isEmpty()"/>
	</action-validate>

	<action-validate name="action-validate-sale-order-check-selection">
		<error message="You have to choose at least one sale order" if="saleOrderToMerge == null || (saleOrderToMerge != null &amp;&amp; saleOrderToMerge.size() == 0)"/>
	</action-validate>

	<action-validate name="action-validate-sale-quotation-check-selection">
		<error message="You have to choose at least one sale quotation" if="saleQuotationToMerge == null || (saleQuotationToMerge != null &amp;&amp; saleQuotationToMerge.size() == 0)"/>
	</action-validate>

	<action-record name="action-saleorder-record-template" model="com.axelor.apps.sale.db.SaleOrder">
		<field name="template" expr="true"/>
		<field name="templateUser" expr="eval: __user__"/>
	</action-record>

	<action-method name="action-sale-order-method-generate-template">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="generateViewTemplate"/>
	</action-method>

	<action-method name="action-sale-order-method-generate-order">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="generateViewSaleOrder"/>
	</action-method>

	<action-method name="action-sale-order-method-create-order">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="createSaleOrder"/>
	</action-method>
	
	<action-method name="action-sale-order-method-create-template">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="createTemplate"/>
	</action-method>

	<action-method name="action-sale-order-method-address-str">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="computeAddressStr"/>
	</action-method>

	<action-method name="action-sale-order-method-fill-company-bank-details">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="fillCompanyBankDetails"/>
 	</action-method>

	<action-method name="action-sale-order-method-edit-order">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="enableEditOrder"/>
	</action-method>

    <action-method name="action-sale-order-validate-changes">
        <call class="com.axelor.apps.sale.web.SaleOrderController" method="validateChanges" />
    </action-method>

	<action-method name="action-sale-method-filter-printing-settings">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="filterPrintingSettings"/>
	</action-method>

	<action-method name="action-sale-method-printing-settings-default-values">
		<call class="com.axelor.apps.sale.web.SaleOrderController" method="fillDefaultPrintingSettings"/>
	</action-method>

	<action-validate name="action-sale-order-validate-check-on-confirm">
		<alert message="The total amount is zero." if="inTaxTotal &lt;= 0"/>
	</action-validate>


	<action-record name="action-sale-record-update-info-company" model="com.axelor.apps.sale.db.SaleOrder">
		<field name="tradingName" expr="eval: null" if="__config__.app.getApp('base').enableTradingNamesManagement"/>
		<field name="printingSettings" expr="eval: company?.printingSettings"/>
	</action-record>

	<action-record name="action-sale-order-manual-unblock" model="com.axelor.apps.sale.db.SaleOrder">
		<field name="manualUnblock" expr="true"/>
	</action-record>

</object-views>
